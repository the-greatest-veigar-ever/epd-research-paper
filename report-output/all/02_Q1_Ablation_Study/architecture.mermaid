graph TD
    subgraph "Phase 1: Persistent Layer (Detection)"
        LogStream[Log Stream / CloudTrail] -->|Events| DetAgent[Detection Agent (SentinelNet)]
        DetAgent -->|Triggers| IntAgent[Intelligence Agent]
    end

    subgraph "Phase 2: Hybrid Consensus"
        IntAgent -->|Proposed Plan| VeriGuard[VeriGuard Consensus]
        VeriGuard -->|Approved?| Decision{Safe?}
        Decision -- No --> Terminate[Log & Block]
    end

    subgraph "Phase 3: EPD Layer (The Ghost Agent)"
        Decision -- Yes --> Factory[Ghost Factory]
        
        subgraph "Just-In-Time Instantiation"
            Factory -->|1. Select Algorithm| ModelRot[Model Rotation]
            ModelRot -->|2. Mutate Prompts| PromptMut[Prompt Mutation Engine]
            PromptMut -->|3. Spawn| Ghost[Ghost Agent Instance]
        end
        
        Ghost -->|Execute Action| CloudAPI[Cloud API / AWS SDK]
        Ghost -->|4. Suicide| Cleanup[Self-Destruct / Memory Wipe]
    end

    style Ghost fill:#f96,stroke:#333,stroke-width:2px,stroke-dasharray: 5 5
    style Factory fill:#bbf,stroke:#333
    style VeriGuard fill:#bfb,stroke:#333
